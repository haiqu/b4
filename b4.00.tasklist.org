#+TITLE: b4.00 : tasklist

* TODO [1/2] get the retro mainloop to run correctly
** DONE [4/4] trace retro.py at each step and bring pascal in line
*** DONE retro.py : allow running step by step
*** DONE run the python and pascal vm's side by side
*** DONE ng.pas : trace to logfile with same format
*** DONE fix the discrepancies
** TODO [0/3] fix the cursor and color handling for extended console
*** TODO position cursor on clrscr
*** TODO position cursor on newline
*** TODO implement proper wrapping behavior
* TODO [2/5] implement an assembler
** DONE export binary numbers padded to proper size
** DONE implement enough of minno to allow in-band debug signals
** TODO only show debug messages when given a flag
** TODO escape the control codes in the output in debug mode
** TODO allow defining aliases up front in a table
* TODO show user-defined words in the debugger
** TODO procedure to walk the dictionary and extract details
*** COMMENT Crc said that positon 2 in the image is the pointer to "last" 
(the address of the last defined word, from which you can follow the links back to get the others.)

See file:~/vrx/doc/Commentary.txt 
and file:~/vrx/examples/autopsy.rx
# ( ~/vrx is just my retroforth working copy )

*** TODO define a record structure to hold the word
*** TODO populate the fields

* TODO set up fpcunit so i have a real test suite
* TODO [2/6] implement the virtual machine                              :pas:
** DONE load the image (machine code) into an array

Will just do this by hand for now, like I did with javascript, and worry about files when I build the assembler.

I figured using a set type would be cleaner, since it numbers implicitly but now I have to cast everything back to a number because we're mixing them with plain integers.

Probably cleaner would just be to use a file. :)

#+name: machine-code
#+begin_src delphi
  
  const ram : array [ 0 .. 25 ] of int32 = (
  
      // set color to red : 4 1 6 out wait ; 
      oLIT, 4,                    //  0  1
      oLIT, 1,                    //  2  3
      oLIT, 6,                    //  4  5
      oOUT, oWAIT,                //  6  7
            
      // draw a pixel
      // : 320 200 2 6 out wait ;
      oLIT, 320,                  //  8  9
      oLIT, 200,                  // 10 11
      oLIT, 2,                    // 12 13
      oLIT, 6,                    // 14 15
      oOUT, oWAIT,                // 16 17
  
      // write 0 to port 3 to force video update. 
      oLIT, 0,                    // 18 19
      oLIT, 3,                    // 20 21
      oOUT, oNOP,                 // 22 23
  
      oNOP, oNOP                  // 24 25
  
  );
  
#+end_src
** DONE load the image from disk
** TODO check that we do these the ngaro way
*** TODO when does ngaro actually do on over/underflow checks?
*** TODO would nos really trigger underflow?
** TODO make stack sizes configurable
** TODO implement a pixel in sdl
** TODO add ability to halt the program
* TODO [0/6] implement io devices
** TODO port 1 : keyboard
*** TODO : should it wait for a key, like readkey? ( right now it's returning -1 )
** TODO port 2 : sending negative value should clear the screen, but doesn't, in js version
portHandlers[2] = function()
{
  Term.renderChar( data.pop );
  ports[ 2 ] = 0;
}
** TODO port 4 : file i/o
*** TODO check c version about port 4 : file i / o -- really a byte at a time?
  http://retroforth.org/docs/The_Ngaro_Virtual_Machine.html
** TODO port 5 : querying the vm { need date/time }
** TODO port 7 : mouse ( fill in mx, my )
** TODO port 8 : enhanced text output
* TODO [0/12] flesh out vm with more ngaro assembly programs
** TODO square : draw a square                                         :nga:
** TODO color  : draw the palette                                      :nga:
** TODO click  : click screen to change color                          :nga:
** TODO keys   : press any key to change color                         :nga:
** TODO hello  : show the word hello                                   :nga:
** TODO caps   : letters on screen (uppercase)                         :nga:
** TODO shift  : captital letters / shift key                          :nga:
** TODO color  : colored text input                                    :nga:
** TODO read   : read a file from disk                                 :nga:
** TODO write  : write a file to disk                                  :nga:
** TODO ngasm  : assembler for ngaro                                   :nga:
** TODO port pixel.hex to pixel.nga
*** NOTE Just use the syntax retro gives when you type =see=
#+begin_example
Retro 11.0 (1309798464)

ok  see ok 
1423 nop   
1424 nop   
1425 lit   4
1427 @     
1428 call  167
1429 0;    
1430 drop  
1431 call  421
1432 lit   54
1434 call  443
1435 ;     

ok  

#+end_example

